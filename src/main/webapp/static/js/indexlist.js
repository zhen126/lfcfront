$(function(){


    Mock.mock(
        'http://localhost:8080/lfcfront/postList?page_start=1&page_capacity=10', {
        	"totalCount":50,
"postList": [
       
    {
      "postId": 19811111,
      "title": "我是文章哈哈哈哈哈回复标方法11111111111111111111111111111111111111111111题diyiyei1",
      "tag": "js框架,Angular",
      "content": "哈哈哈哈哈哈 内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题222222222222222",
      "tag": "js框架,Angular",
      "content": "文章章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题333333333333333",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
     {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
     {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
     {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
     {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
     {
      "postId": 198,
      "title": "哈哈哈哈文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内wfdwvdsvsvdsvd容<img src=images/photo.jpg></img>dsds山沟沟内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容vdsavdsavdsaavdsaavdav",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题sqsqsqsqsqsqsqsqs",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    }
]
        }
    );
    
    
    
    
    
        Mock.mock(
        'http://localhost:8080/lfcfront/postList', {
        	"totalCount":50,
"postList": [
    {
      "postId": 198,
      "title": "我是文章标题",
      "tag": "js框架,Angular",
      "content": "内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内wfdwvdsvsvdsvd容<img src=images/photo.jpg></img>dsds山沟沟内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容vdsavdsavdsaavdsaavdav",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    }
]
        }
    );
    
    
    
    
    
    
    
    
    
    
    
    
        Mock.mock(
        'http://localhost:8080/lfcfront/postList?page_start=2&page_capacity=10', {
        	"totalCount":50,
"postList": [
    {
      "postId": 1923432432143214321,
      "title": "我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题我是文章标题",
      "tag": "js框架,Angular",
      "content": "内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章时光飞逝大概内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章内容章",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    },
    {
      "postId": 198,
      "title": "文FAADSFADSAFDSAFDSAFDSAFSDAFASDFDA章标题",
      "tag": "js框架,Angular",
      "content": "文章内容",
      "author": "张三",
      "time": "2015年12月21日 18:36"
    }
]
        }
    );
    
    
            Mock.mock(
        'http://localhost:8080/lfcfront/delPost?postId=198', {
        	"state":0
     }
    );
    
    

 var pages=1;//定义当前是第几页
 var maxpages=1;//记录最大页数
         onloadData(1,10);
			//封装
			function onloadData(targetIndex,numbers) {
			pages=targetIndex;
				 
				$.ajax({
					url: "http://localhost:8080/lfcfront/postList",
					dataType: "json",
					async: true,
					type: "GET",
					data: {
						page_start: targetIndex,//开始页数
						page_capacity: numbers //查询条数
					},
					success: function(jsons) {
//					 
							$(".content_left").empty(); //清空
							var dataArr = jsons.postList;
							
							for(var i = 0; i <dataArr.length; i++) {
								console.log(i);
								createDiv(dataArr[i].postId, dataArr[i].title, dataArr[i].tag, dataArr[i].content, dataArr[i].author,dataArr[i].time);
							}
							var cents=$('<div class="pagelist"><ul></ul></div>');
							$(".content_left").append(cents);
						getPageCount(targetIndex,numbers);
					},
					error:function(){
						console.log("错误");
					}
				});
			}
				 		//首次页面加载进来显示的是第一页数据

//			
			//创建列表项
			function createDiv(postId,title,tag,content,author,time) {	 
				var strings=/<img[^>]+>/g;//匹配img标签
				var str = content.match(strings);//返回匹配的img（是个数组）
				var truecontents=content;//去除img标签后的内容
				var pclassname="nohaveimgp";
//				console.log(str);
				if(str!=null){
//						console.log(str[0]);
						var stre=str[0];//包裹img的div内容
						truecontents=content.replace(strings,"");
					  pclassname="haveimgp";
				}else{
					var stre="";//包裹img的div内容
				}	
               var html =$('<div class="arc_list" postId='+postId+'><h1><a href="arc_info.html" title="">'+title+'</a></h1><span>作者：<a href="search.html">'+author+'</a>   时间：'+time+'</span><div class="ifhaveimg">'+stre+'</div><p class='+pclassname+'>'+truecontents+'</p><button><a href="arc_info.html">查看更多</a></button><button class="deletes">删除</button></div>');
				$(".content_left").prepend(html);
//					 	   var h= html.height();
//				           html.height(0);//设置动画的初始值为0
//				           html.animate({
//				                      	height:h//动画终止的地方
//				                      },300);
				//删除
//				html.find(".deletes").click(function() {
//					html.animate({
//						height: 0
//					}, "slow", function() {
//						$(this).remove();
//					});
//				});
			}
//			
//			
			//删除
			$(document).on("click", ".deletes", function(event) {
				var target = $(event.target);
				var targetId = target.parents("div").attr("postId");	
					 	
//				var activeNum = target.parents("#message_text").next().find(".active").html() - 1;
				$.ajax({
					type: "get",
					url: "http://localhost:8080/lfcfront/delPost",
					dataType: "json",
					data: {
						postId: targetId,
					},
					success: function(data) {
						if(data.state == 0) { //删除成功
					target.parent("div").remove();
							var cents=$('<div class="mengban"><div class="mengbanin"><h1>删除成功</h1><button>确定</button><img src="images/close.png"></img></div></div>');
							$("body").append(cents);
							var time1=setTimeout(function(){
				cents.remove();
			},1000);
							onloadData(pages,10);
						}else{
							
						}
					}
				});
			});
			//删除蒙板
			$(document).on("click",".mengbanin img",function(e){
			 
				var events =e||window.event;
				var cent =$(events.target);
				cent.parent().parent().remove();
				
			});
			//删除蒙板
				$(document).on("click",".mengbanin button",function(e){
			 
				var events =e||window.event;
				var cent =$(events.target);
				cent.parent().parent().remove();
				
			});
			
			$(document).on("click",".topPages",function(){
//				 console.log(pages);
				 if(pages<2){
				 	
				 }else{
				 	onloadData(pages-1,10);
				 }
			});
			$(document).on("click",".nextPages",function(){
				 
//				 console.log(maxpages); 
				 if(pages>=maxpages){
				 	
				 }else{
				 	 	onloadData(parseInt(pages)+1,10);
				 }
			});
		
		//分页-展示页isu
			$(document).on("click", ".pagelist>ul li a", function(event) {
				var target = $(event.target); //获取当前点击的节点
				var targetIndex = target.attr("indexs"); //获取点击页码的索引值
				onloadData(targetIndex,10);
//              alert(targetIndex);
			});

			function getPageCount(targetIndex,numbers) {
				$.ajax({
					url: "http://localhost:8080/lfcfront/postList",
					type: "get",
					dataType: "json",
					data: {
                        page_start: targetIndex,//开始页数
						page_capacity: numbers //查询条数
					},
					success: function(data) {
						var cents = data.totalCount;
						maxpages=Math.ceil(cents/numbers);
//						console.log(maxpages);//						if(data.err == 0) {
							$(".pagelist>ul li").remove(); //初始化
							//	 	        	      				alert(data.countpage);
							var astart = $('<li><a href="javascript:void(0)" indexs=1>首页</a></li>');
							$(".pagelist>ul").append(astart);
							var atop = $('<div class="topPages"><a href="javascript:void(0)" class="toppage"><i class="iconfont icon-iconfonti2-copy"></i></a></div>');
							$(".pagelist>ul").append(atop);
							
							for(var i = 0; i <maxpages; i++) {
								var aObj = $('<li><a href="javascript:void(0)" indexs=' + (i+1) + '>' + (i + 1) + '</a></li>');
								$(".pagelist>ul").append(aObj);
							}
							var anext = $('<div class="nextPages"><a href="javascript:void(0)" class="nextpage"><i class="iconfont icon-iconfonti2"></i></a></div>');
							$(".pagelist>ul").append(anext);
							var aend = $('<li><a href="javascript:void(0)" indexs=' + i + '>尾页</a></li>');
							$(".pagelist>ul").append(aend);
							//当前页加active
							$(".pagelist>ul li").eq(targetIndex).addClass("cur");
//						}
					}
				});
			}

	 
});
